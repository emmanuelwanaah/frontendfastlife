<html>
  <head>
    <link rel="preconnect" href="https://fonts.gstatic.com/" crossorigin="" />
    <link
      rel="stylesheet"
      as="style"
      onload="this.rel='stylesheet'"
      href="https://fonts.googleapis.com/css2?display=swap&amp;family=Noto+Sans%3Awght%40400%3B500%3B700%3B900&amp;family=Plus+Jakarta+Sans%3Awght%40400%3B500%3B700%3B800"
    />

    <title>FastLifeTravel</title>
    <link rel="icon" type="image/x-icon" href="data:image/x-icon;base64," />
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/litepicker/dist/css/litepicker.css" />
    <script src="https://cdn.jsdelivr.net/npm/litepicker/dist/litepicker.js"></script>
    
    <script src="https://cdn.tailwindcss.com?plugins=forms,container-queries"></script>








    <style>
        .litepicker .container__days .day-item.is-start-date,
        .litepicker .container__days .day-item.is-end-date {
          background-color: #3484ca;
          color: white;
          border-radius: 9999px;
        }
      
        .litepicker .container__days .day-item.is-in-range {
          background-color: #f1f2f4;
        }
      
        .litepicker .container__days .day-item:hover {
          background-color: #e2e8f0;
        }
      </style>
      







      <script src="https://js.stripe.com/v3/"></script>

  </head>
  <body>
    <div
      class="relative flex size-full min-h-screen flex-col bg-white group/design-root overflow-x-hidden"
      style='--radio-dot-svg: url(&apos;data:image/svg+xml,%3csvg viewBox=%270 0 16 16%27 fill=%27rgb(18,21,23)%27 xmlns=%27http://www.w3.org/2000/svg%27%3e%3ccircle cx=%278%27 cy=%278%27 r=%273%27/%3e%3c/svg%3e&apos;); font-family: "Plus Jakarta Sans", "Noto Sans", sans-serif;'
    >
      <div class="layout-container flex h-full grow flex-col">
        <header class="flex items-center justify-between whitespace-nowrap border-b border-solid border-b-[#f1f2f4] px-10 py-3">
          <div class="flex items-center gap-4 text-[#121517]">
            <div class="flex items-center gap-4 text-[#111418]">
              <img class="d-inline-block align-top img-fluid" src="/assets/img/logo.png" alt="" width="90" />
              
            </div>
   
          </div>
          <div class="flex flex-1 justify-end gap-8">
            <div class="flex items-center gap-9">
              <a class="text-[#121517] text-sm font-medium leading-normal" href="#">Explore</a>
              <a class="text-[#121517] text-sm font-medium leading-normal" href="wishlist.html">Wishlist</a>
              <a class="text-[#121517] text-sm font-medium leading-normal" href="completedbookings.html">Trips</a>
              <a class="text-[#121517] text-sm font-medium leading-normal" href="#">Messages</a>
            </div>
            <button
              class="flex max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-full h-10 bg-[#f1f2f4] text-[#121517] gap-2 text-sm font-bold leading-normal tracking-[0.015em] min-w-0 px-2.5"
            >
              <div class="text-[#121517]" data-icon="Globe" data-size="20px" data-weight="regular">
                <svg xmlns="http://www.w3.org/2000/svg" width="20px" height="20px" fill="currentColor" viewBox="0 0 256 256">
                  <path
                    d="M128,24A104,104,0,1,0,232,128,104.11,104.11,0,0,0,128,24ZM101.63,168h52.74C149,186.34,140,202.87,128,215.89,116,202.87,107,186.34,101.63,168ZM98,152a145.72,145.72,0,0,1,0-48h60a145.72,145.72,0,0,1,0,48ZM40,128a87.61,87.61,0,0,1,3.33-24H81.79a161.79,161.79,0,0,0,0,48H43.33A87.61,87.61,0,0,1,40,128ZM154.37,88H101.63C107,69.66,116,53.13,128,40.11,140,53.13,149,69.66,154.37,88Zm19.84,16h38.46a88.15,88.15,0,0,1,0,48H174.21a161.79,161.79,0,0,0,0-48Zm32.16-16H170.94a142.39,142.39,0,0,0-20.26-45A88.37,88.37,0,0,1,206.37,88ZM105.32,43A142.39,142.39,0,0,0,85.06,88H49.63A88.37,88.37,0,0,1,105.32,43ZM49.63,168H85.06a142.39,142.39,0,0,0,20.26,45A88.37,88.37,0,0,1,49.63,168Zm101.05,45a142.39,142.39,0,0,0,20.26-45h35.43A88.37,88.37,0,0,1,150.68,213Z"
                  ></path>
                </svg>
              </div>
            </button>
            <a href="usersettings.html">
              <div
              class="bg-center bg-no-repeat aspect-square bg-cover rounded-full size-10"
              style='background-image: url("https://lh3.googleusercontent.com/aida-public/AB6AXuAQZYCTo-i-mYv84YdWgTzVoc-jjwbUgOm2mNvYOthyCKH4-DJDYfbmf7vLhmMqUnUrRtombouxbmJOJeMmfAc8GNOQgIGKUPKkp3_AwPXAmBRb5HZ6aDTN2AIGoyKQsBo6VFJFvJFgtoSo6DZyZAI5zuaRQ_-x-ZWQq6Yxv9Jg_LflIjVv5PHHHiJ1S0qoYA9Yf6HgDXABNs6gSeFinb4okmkyJ5_uYd2vP7AY1CBmnN-Rs0vqSxpuWOBltphqPTWYsMdEOFgGNXs");'
            ></div>
            </a>
          </div>
        </header>
              <!-- Payment Section -->
<div id="payment-section" class="hidden px-40 py-10">
    <div class="layout-content-container flex flex-col max-w-[960px] flex-1 mx-auto">
      <h2 class="text-[#121517] text-2xl font-bold mb-6">Complete Your Payment</h2>
  
      <div id="payment-activities" class="space-y-4 mb-4"></div>
  
      <div class="text-right text-[#121517] text-lg font-bold">
        Total: <span id="payment-total-display">€0.00</span>
      </div>
  
      <div class="flex justify-end mt-6">
        <button
          id="pay-now"
          class="bg-[#3484ca] text-white rounded-full px-6 py-3 text-sm font-bold tracking-wide"
        >
          Pay Now
        </button>
      </div>
    </div>
  </div>
        <div id="order-content" class="px-40 flex flex-1 justify-center py-5">

          <div class="layout-content-container flex flex-col max-w-[960px] flex-1">
            <div class="flex flex-wrap justify-between gap-3 p-4"><p class="text-[#121517] tracking-light text-[32px] font-bold leading-tight min-w-72">Your Trip</p></div>

            <!-- activities  -->
            <h3 class="text-[#121517] text-lg font-bold leading-tight tracking-[-0.015em] px-4 pb-2 pt-4">Activities</h3>
            <div id="wishlist-activities" class="space-y-4 p-4"></div>
<!-- activities end  -->
            <!-- dates  -->
<!<h3 class="text-[#121517] text-lg font-bold leading-tight tracking-[-0.015em] px-4 pb-2 pt-4">Dates</h3>
<div class="p-4">
  <h3 class="text-[#121517] text-lg font-bold leading-tight tracking-[-0.015em] pb-2">Select Dates</h3>
  <input
    id="date-range"
    class="w-full max-w-md border border-gray-300 rounded-xl p-3 text-[#121517] placeholder:text-gray-500 text-sm focus:outline-none focus:ring-2 focus:ring-blue-500"
    placeholder="Pick a start and end date"
    readonly
  />
</div>
<p id="nights-display" class="text-[#677683] text-sm font-normal leading-normal pb-1 pt-1 px-4">...</p>
<p id="date-display" class="text-[#677683] text-sm font-normal leading-normal px-4">...</p>

<!-- dates end  -->

            
            <h3 class="text-[#121517] text-lg font-bold leading-tight tracking-[-0.015em] px-4 pb-2 pt-4">Trip Summary</h3>
<div id="trip-summary" class="p-4 grid grid-cols-[20%_1fr] gap-x-6">
  <!-- Dynamic rows will go here -->
  <div class="col-span-2 grid grid-cols-subgrid border-t border-t-[#dde1e4] py-5">
    <p class="text-[#677683] text-sm font-normal leading-normal">Subtotal</p>
    <p id="trip-subtotal" class="text-[#121517] text-sm font-normal leading-normal">Loading...</p>
  </div>
</div>

           
            <div class="p-4 grid grid-cols-[20%_1fr] gap-x-6">
                <div class="col-span-2 grid grid-cols-subgrid border-t border-t-[#dde1e4] py-5">
                    <p class="text-[#677683] text-sm font-normal leading-normal">Total</p>
                    <p id="trip-total" class="text-[#121517] text-sm font-bold leading-normal">€0.00</p>
                  </div>
            </div>
           
            <div class="flex px-4 py-3">
              <button id="continue-btn"
                class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-full h-12 px-5 flex-1 bg-[#3484ca] text-white text-base font-bold leading-normal tracking-[0.015em]"
              >
                <span class="truncate">Continue to Confirmation</span>
              </button>
              

            </div>
          </div>
        </div>
      </div>

  
    </div>
    <script>
        document.addEventListener('DOMContentLoaded', async () => {
          const container = document.getElementById('wishlist-activities');
      
          try {
            const res = await fetch('/api/wishlist', { credentials: 'include' });
            if (!res.ok) {
              container.innerHTML = '<p class="text-red-600">Failed to load wishlist.</p>';
              return;
            }
      
            const wishlist = await res.json();
      
            if (!Array.isArray(wishlist) || wishlist.length === 0) {
              container.innerHTML = '<p class="text-gray-500 text-sm">Your wishlist is empty.</p>';
              return;
            }
      
            container.innerHTML = wishlist.map(item => `
              <div class="flex items-stretch justify-between gap-4 rounded-xl">
                <div class="flex flex-[2_2_0px] flex-col gap-4">
                  <div class="flex flex-col gap-1">
                    <p class="text-[#677683] text-sm font-normal leading-normal">Wishlist</p>
                    <p class="text-[#121517] text-base font-bold leading-tight">${item.title}</p>
                    <p class="text-[#677683] text-sm font-normal leading-normal">${item.location} · ${new Date().toLocaleDateString()}</p>
                  </div>
                  <button
                    class="flex min-w-[84px] max-w-[480px] cursor-pointer items-center justify-center overflow-hidden rounded-full h-8 px-4 flex-row-reverse bg-[#f1f2f4] text-[#121517] text-sm font-medium leading-normal w-fit"
                  >
                    <span class="truncate">€${Number(item.price).toFixed(2)}</span>
                  </button>
                </div>
                <div
                  class="w-full bg-center bg-no-repeat aspect-video bg-cover rounded-xl flex-1"
                  style='background-image: url("${item.image_url}")'
                ></div>
              </div>
            `).join('');
          } catch (err) {
            console.error('❌ Failed to fetch wishlist:', err);
            container.innerHTML = '<p class="text-red-600">An error occurred.</p>';
          }
        });
      </script>




      <script src="https://cdn.jsdelivr.net/npm/litepicker/dist/litepicker.js"></script>
      <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/litepicker/dist/css/litepicker.css" />
      

      <script>
        const API_BASE = 'https://fastlife-production.up.railway.app';
      </script>
      
      <script>
        document.addEventListener('DOMContentLoaded', () => {
            const input = document.getElementById('date-range');
            const nightsDisplay = document.getElementById('nights-display');
            const dateDisplay = document.getElementById('date-display');
          
            const picker = new Litepicker({
              element: input,
              singleMode: false,
              numberOfMonths: 2,
              numberOfColumns: 2,
              minDate: new Date(),
              autoApply: true,
              format: 'YYYY-MM-DD',
              setup: (picker) => {
                picker.on('selected', (start, end) => {
                  const nights = end.diff(start, 'day');
                  const formattedStart = start.format('MMMM D, YYYY');
                  const formattedEnd = end.format('MMMM D, YYYY');
          
                  nightsDisplay.textContent = `${nights} night${nights !== 1 ? 's' : ''}`;
                  dateDisplay.textContent = `From ${formattedStart} to ${formattedEnd}`;
                  input.value = `${formattedStart} → ${formattedEnd}`;
                });
              }
            });
          });
          
    </script>


    <script>
      document.addEventListener('DOMContentLoaded', async () => {
        const API_BASE = 'https://fastlife-production.up.railway.app';
        const summaryContainer = document.getElementById('trip-summary');
        const subtotalElement = document.getElementById('trip-subtotal');
        const totalElement = document.getElementById('trip-total');
    
        const urlParams = new URLSearchParams(window.location.search);
        const idsParam = urlParams.get('activityIds');
        if (!idsParam) {
          subtotalElement.textContent = '€0.00';
          totalElement.textContent = '€0.00';
          return;
        }
    
        try {
          const res = await fetch(`${API_BASE}/api/wishlist`, { credentials: 'include' });
          const activities = await res.json();
          const selectedIds = idsParam.split(',').map(id => parseInt(id));
          const selectedActivities = activities.filter(item => selectedIds.includes(item.id));
    
          let subtotal = 0;
          const subtotalRow = subtotalElement.closest('div.col-span-2');
    
          for (const activity of selectedActivities) {
            const row = document.createElement('div');
            row.className = "col-span-2 grid grid-cols-subgrid border-t border-t-[#dde1e4] py-5";
            row.innerHTML = `
              <p class="text-[#677683] text-sm font-normal leading-normal">${activity.title}</p>
              <p class="text-[#121517] text-sm font-normal leading-normal">€${Number(activity.price).toFixed(2)}</p>
            `;
            summaryContainer.insertBefore(row, subtotalRow);
            subtotal += parseFloat(activity.price || 0);
          }
    
          subtotalElement.textContent = `€${subtotal.toFixed(2)}`;
          const serviceFee = 0;
          totalElement.textContent = `€${(subtotal + serviceFee).toFixed(2)}`;
        } catch (err) {
          console.error('❌ Failed to load trip summary:', err);
          subtotalElement.textContent = 'Error';
          totalElement.textContent = 'Error';
        }
      });
    </script>
    


    <script>
      let formattedDateRange = '';
      let formattedNights = '';
    
      document.addEventListener('DOMContentLoaded', () => {
        const input = document.getElementById('date-range');
        const nightsDisplay = document.getElementById('nights-display');
        const dateDisplay = document.getElementById('date-display');
    
        const picker = new Litepicker({
          element: input,
          singleMode: false,
          numberOfMonths: 2,
          numberOfColumns: 2,
          minDate: new Date(),
          autoApply: true,
          format: 'YYYY-MM-DD',
          setup: (picker) => {
            picker.on('selected', (start, end) => {
              const nights = end.diff(start, 'day');
              const formattedStart = start.format('MMMM D, YYYY');
              const formattedEnd = end.format('MMMM D, YYYY');
    
              formattedDateRange = `${formattedStart} → ${formattedEnd}`;
              formattedNights = `${nights} night${nights !== 1 ? 's' : ''}`;
              nightsDisplay.textContent = formattedNights;
              dateDisplay.textContent = `From ${formattedStart} to ${formattedEnd}`;
              input.value = formattedDateRange;
            });
          }
        });
      });
    
      document.getElementById('continue-btn').addEventListener('click', async () => {
        const API_BASE = 'https://fastlife-production.up.railway.app';
        const dateRange = formattedDateRange;
        const nights = formattedNights;
        const total = document.getElementById('trip-total').textContent;
    
        const paymentActivities = document.getElementById('payment-activities');
        const paymentTotal = document.getElementById('payment-total-display');
    
        const urlParams = new URLSearchParams(window.location.search);
        const idsParam = urlParams.get('activityIds');
        const selectedIds = idsParam ? idsParam.split(',').map(id => parseInt(id)) : [];
    
        if (!dateRange || selectedIds.length === 0) {
          alert('Please select a date range and at least one activity before continuing.');
          return;
        }
    
        try {
          const res = await fetch(`${API_BASE}/api/wishlist`, { credentials: 'include' });
          const wishlist = await res.json();
          const activities = wishlist.filter(item => selectedIds.includes(item.id));
          const activitySummary = [];
    
          paymentActivities.innerHTML = activities.map(act => {
            activitySummary.push({
              id: act.id,
              title: act.title,
              price: Number(act.price),
              location: act.location,
              image: act.image_url,
              dateRange,
              nights
            });
    
            return `
              <div class="flex gap-4 items-start border-b border-[#dde1e4] pb-4">
                <div class="w-24 h-16 rounded-lg bg-cover bg-center shrink-0" style="background-image: url('${act.image_url}')"></div>
                <div class="flex flex-col flex-1">
                  <p class="text-[#121517] font-semibold text-sm">${act.title}</p>
                  <p class="text-[#677683] text-sm">${act.location}</p>
                  <p class="text-[#677683] text-xs">${dateRange}</p>
                  <p class="text-[#677683] text-xs">${nights}</p>
                </div>
                <p class="text-[#121517] font-medium text-sm">€${Number(act.price).toFixed(2)}</p>
              </div>
            `;
          }).join('');
    
          paymentTotal.textContent = total;
    
          window.bookingData = {
            dateRange,
            nights,
            total,
            activities: activitySummary
          };
    
          document.getElementById('order-content').classList.add('hidden');
          document.getElementById('payment-section').classList.remove('hidden');
        } catch (err) {
          console.error('❌ Booking display error:', err);
          alert('Something went wrong.');
        }
      });
    </script>
    
    <script>
      const payNowBtn = document.getElementById('pay-now');
    
      payNowBtn.addEventListener('click', async () => {
        const API_BASE = 'https://fastlife-production.up.railway.app';
    
        try {
          const booking = window.bookingData;
    
          if (!booking || !booking.activities || booking.activities.length === 0) {
            alert('No booking information found. Please try again.');
            return;
          }
    
          if (!booking.reference) {
            booking.reference = 'REF' + Math.floor(100000000 + Math.random() * 900000000);
          }
    
          localStorage.setItem('booking', JSON.stringify(booking));
          localStorage.removeItem('bookingConfirmed');
    
          const response = await fetch(`${API_BASE}/api/create-checkout-session`, {
            method: 'POST',
            credentials: 'include',
            headers: {
              'Content-Type': 'application/json'
            },
            body: JSON.stringify(booking)
          });
    
          const session = await response.json();
          if (!session.id) throw new Error('No session ID returned from Stripe.');
    
          const stripe = Stripe('pk_test_51RXWEQ2ZQv0CP5NuQC2KjGUfXKeTB5Zv5eqDlQ1KEcLEvvv7L8JupHFIL6O51DvSn50sNgE0ITrNP4Kg3kLD1WZR006lY54SrJ');
          stripe.redirectToCheckout({ sessionId: session.id });
        } catch (err) {
          console.error('❌ Payment initiation failed:', err);
          alert('Payment failed to start. Please try again.');
        }
      });
    </script>
    
  </body>
</html>




